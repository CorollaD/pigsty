# 真实世界的PostgreSQL

本书主要介绍 —— 真实使用场景下的PG。基于pigsty项目，演示如何在真实生产环境中部署、管理与维护大规模PostgreSQL集群。



[TOC]

## 第一部分：上手

### 快速开始

* 集群概览
* 基本概念
* 上手指南
* 客户端工具
* 连接方式

### 观察

* 监控概览
* 节点监控
* 实例监控
* 集群监控
* 慢查询
* 其它



## 第二部分：部署

### 系统规划

* 容量评估
* 硬件规划
* 硬件性能评测
* 选择合适的环境
* 构建本地开发测试环境
* Vagrant快速上手

### 基础设施

* Ansible快速上手
* 本地源
* 本地CA
* 离线安装部署
* DNS服务部署
* NTP服务部署
* DCS服务选型
* DCS服务部署
* 监控服务部署

### 数据库

* Postgres单机部署
* Postgres主从部署
* Pgbouncer部署
* Patroni部署
* 使用Patroni初始化集群
* 定制数据库模板
* 针对业务模式优化

### 接入层

* 选择合适的接入方式
* 使用Pgbouncer
* DNS服务选型
* DNS服务
* Haproxy接入
* Haproxy健康检查
* Keepalived健康检查

### 高可用

* 高可用方案对比
* Patroni与Patroni2
* 高可用常见场景模拟实验
* 故障检测
* 故障切换
* Fencing
* 流量切换
* 参数调优



## 第三部分：监控

### 监控系统

* 架构概览
* Prometheus快速上手
* node_exporter快速上手
* pg_exporter快速上手
* 服务发现

### 监控指标

* 操作系统指标
* 数据库指标
* 连接池指标
* 负载均衡器指标
* 聚合指标
* 预计算规则

### 报警系统

* 基于Grafana的简易报警系统
* 基于Altermanager的生产级报警系统
* 报警规则概览
* 阈值调优

### 日志系统

* PostgreSQL日志格式
* PostgreSQL日志配置选项
* 使用mtail收集日志监控指标
* 使用filebeat收集PG日志
* 使用PgBadger提取日志摘要

* PG日志中的重要信息
* PG日志可视化
* 使用SQL处理分析PG日志

### 系统目录

* 探索PG Catalog
* 表相关信息
* 索引相关信息

* 对象管理



## 第四部分：管理

### 备份恢复

* 常用备份策略
* 验证备份可用性
* 并行备份
* 时间点恢复
* 持续归档
* 延迟备库
* 备份管理

### 日常维护

* 变更管理与版本控制
* 发布工作流
* 扩容缩容
* 版本升级
* 清理调优
* 巡检事项
* 定时任务
* 慢查询优化
* 开发规约

### 故障处理

* 方法论
* 故障定位常用方法
* 故障检查清单
* 典型故障案例：硬件故障
* 典型故障案例：过载雪崩
* 典型故障案例：数据损坏
* 典型故障案例：删库删表
* 其他典型案例
* 故障管理制度

### 安全加固

* 数据库权限模型
* 数据库默认权限
* 数据库白名单策略
* 连接池安全加固
* 使用公私钥基础设施
* 使用SSL加固Postgres
* Consul安全加固
* ETCD安全加固
* Patroni安全加固

### 

