---
################################################################
# node provision
################################################################
# node hostname override : use {{ cluseter }}-{{ seq } if defined
node_overwrite_hostname: true

# node timezone override
node_timezone: 'Asia/Shanghai'     # default node timezone

# node feature switch
node_disable_numa: false        # [VERY IMPORTANT] disable numa, skip for vm or single CPU setup
node_disable_swap: true         # [VERY IMPORTANT] disable swap for pg and kubernetes
node_disable_thp: true          # [VERY IMPORTANT] disable transparent huge page
node_disable_firewall: true     # disable firewall to allow haproxy and kubernetes
node_disable_selinux: true      # disable selinux
node_cpupower_performance: true # set cpupower governor to performance mode if available
node_disk_prefetch: false       # setup disk prefetch on HDD to increase performance

# node kernel modeles
node_kernel_modules: [softdog, br_netfilter, ip_vs, ip_vs_rr, ip_vs_rr, ip_vs_wrr, ip_vs_sh, nf_conntrack_ipv4]

# node sysctl
node_sysctl_dynamic_tuning: true  # set some param based on node fact
# additional sysctl parameters (overwrite with your own)
node_sysctl_params:
  # kubernetes require parameters
  net.bridge.bridge-nf-call-ip6tables: 1
  net.bridge.bridge-nf-call-iptables: 1
  net.bridge.bridge-nf-call-arptables: 1

# static dns records in /etc/hosts
# most entries here are not necessary except pigsty and yum.pigsty
# local yum repo require these two static dns to work
node_static_dns:
  # loopback
  - host: 127.0.0.1
    domain: [localhost, local, lc]
  # meta controller node
  - host: 10.10.10.10
    domain: [meta, master, controller, pigsty, yum.pigsty]
  # common nodes
  - host: 10.10.10.10
    domain: [node-0, n0]
  - host: 10.10.10.11
    domain: [node-1, n1]
  - host: 10.10.10.12
    domain: [node-2, n2]
  - host: 10.10.10.13
    domain: [node-3, n3]



################################################################
# infra provision
################################################################

#==============================================================#
# infra
#==============================================================#
infra_local_repos: [pigsty.repo]      # local yum repo file path
infra_disable_external_repo: true     # disable all other repos except local
infra_proxy_env: {}                   # add proxy environment variable here

# common infra packages
infra_packages:
  - etcd,consul,haproxy,keepalived,node_exporter,chrony,ntp                             # must have
  - uuid,readline,zlib,openssl,libxml2,libxslt,pgbouncer                                # pg util
  - lz4,nc,pv,jq,make,patch,bash,lsof,wget,unzip,git,numactl,grubby,perl-ExtUtils-Embed # basic utils
  - bind-utils,net-tools,sysstat,tcpdump,socat,ipvsadm,python-ipython,python-psycopg2   # net utils

# cloud native support
infra_cloud_native_support: false
infra_cloud_native_packages:
  - docker-ce,docker-ce-cli,rkt,kubelet,kubectl,kubeadm,kubernetes-cni,helm

# build toolchain support
infra_build_essential_support: false
infra_build_essential_packages:
  - gcc,gcc-c++,clang,coreutils,diffutils,rpm-build,rpm-devel,rpmlint,rpmdevtools
  - zlib-devel,openssl-libs,openssl-devel,pam-devel,libxml2-devel,libxslt-devel,openldap-devel,systemd-devel,tcl-devel,python-devel

# add additional packages here
infra_additional_packages: []                     # additional rpm packages to be downloaded/installed

# DNS and NTP
infra_dns_servers: [10.10.10.10]                  # default DNS server (meta node dnsmasq by default)
infra_ntp_servers: [10.10.10.10]                  # default NTP server (meta node chronyd service)

#==============================================================#
# dcs
#==============================================================#
dcs_type:    consul                               # default dcs server type: consul
dcs_servers: [10.10.10.10]                        # default dcs servers
dcs_purge: true                                   # force remove existing server
dcs_check_interval: 5s                            # default service check interval
dcs_check_timeout:  1s                            # default service check timeout

#==============================================================#
# cloud-native
#==============================================================#
# docker & k8s
docker_cgroups_driver: systemd                                    # docker default cgroup fs driver
docker_image_cache: /www/pigsty/docker-images.tar.lz4             # docker images cache path (.tar.lz4)
docker_registry_mirrors: ["https://zbwt4y5v.mirror.aliyuncs.com"] # docker registry mirror
k8s_registry_mirrors: registry.aliyuncs.com/google_containers     # kubernetes versionaliyun k8s miiror repository

k8s_servers: [10.10.10.10]                                        # kubernetes servers (masters)
k8s_version: 1.18.3                                               # kubernetes version
k8s_pod_cidr: "10.11.0.0/16"                                      # kubernetes pod network cidr
k8s_service_cidr: "10.12.0.0/16"                                  # kubernetes service network cidr
k8s_dashboard_admin_user: dashboard-admin-sa                      # kubernetes dashboard admin user name
# k8s_role: node                                                  # overwrite this for master node


################################################################
# meta
################################################################
metadb_url: postgres://meta@pg-meta/meta
grafana_url: http://grafana.pigsty/api
prometheus_url: http://prometheus.pigsty/api
alertmanager_url: http://alertmanager.pigsty/api


################################################################
# monitor
################################################################
monitor_port_node_exporter:   9100         # node exporter port
monitor_port_pg_exporter:     9630         # postgres exporter port
monitor_pgbouncer_exporter:   9631         # pgbouncer exporter port
monitor_haproxy_exporter:     9101         # pgbouncer exporter port
monitor_exporter_metric_path: "/metrics"   # default exporter port


################################################################
# load balancer
################################################################
keepalived_nic: eth1          # REQUIRED field nic interface





...
