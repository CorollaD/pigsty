#!/usr/bin/env ansible-playbook
---
#==============================================================#
# File      :   repo-init.yml
# Mtime     :   2020-06-20
# Desc      :   init repo node
# Path      :   repo-init.yml
# Author    :   Vonng(fengruohang@outlook.com)
# Note:
#
# Init a local yum repo powered by a local nginx web server
# all necessary rpm packages are downloaded to accelerate
# cluster initialization, or in case that target machine does
# not have internet access.
#
# RPM packages are downloaded to /www/{{ repo_name }}. And it will skip
# download if all packages are already downloaded in there.
#
# Local yum repo url:  http://{{ repo_host }}/{{ repo_name }}/
#==============================================================#
- name: Init local yum repo on node
  become: yes
  hosts: all
  gather_facts: no
  tags: node

  vars:
    # node_overwrite_hostname: false
    # node_timezone: 'Asia/Shanghai'     # default node timezone
    # node_disable_numa: false        # [VERY IMPORTANT] disable numa, skip for vm or single CPU setup
    # node_disable_swap: true         # [VERY IMPORTANT] disable swap for pg and kubernetes
    # node_disable_firewall: true     # disable firewall to allow haproxy and kubernetes
    # node_disable_selinux: true      # disable selinux
    # node_disk_prefetch: false       # setup disk prefetch on HDD to increase performance
    # node_kernel_modules: [softdog, br_netfilter, ip_vs, ip_vs_rr, ip_vs_rr, ip_vs_wrr, ip_vs_sh, nf_conntrack_ipv4]
    # node_tune: true                 # tune node parameters
    # node_sysctl_params: {}          # additional sysctl parameters
    # node_root_setup: false          # setup root user(ssh exchange) ?
    node_static_dns:                # write localhost to static dns
      - host: 127.0.0.1
        domain: [localhost]

  roles:
    - role: node          # tune node settings
#    - role: repo_install  # install local yum repo
#    - role: node_pkgs     # install rpm packages

...