---
#==============================================================#
# Stage 2: Download bootstrap packages if not exists
#==============================================================#
- name: Pigsty repo boostrap packages download
  block:
    - name: Enable default centos yum repos
      ignore_errors: true
      command: yum-config-manager --enable base extras updates epel-release

    # install official yum repo
    - name: Install official centos yum repos
      environment: "{{ repo_proxy_env | default({}) }}"
      yum: name=epel-release,centos-release-scl,centos-release-scl-rh

    # copy nginx yum repo
    - name: Install additional nginx yum repo
      copy: src=repo/nginx.repo dest=/etc/yum.repos.d/nginx.repo mode=0644

    # download minimal package to build a local yum repo
    - name: Download bootstrap packages
      environment: "{{ repo_proxy_env | default({}) }}"
      yum:
        download_only: yes
        download_dir: /www/pigsty/boot
        name: epel-release,createrepo,wget,yum-utils,nginx

    # set bootstrap packages download complete flag
    - name: Bootstrap packages downloaded
      copy: content=ok dest=/www/pigsty/boot/boot_complete
...